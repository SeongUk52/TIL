# 4장 역할, 책임, 협력

> 우리 모두를 합친 것보다 더 현명한 사람은 없다.

- 협력이라는 문맥이 객체의 행동 방식을 결정한다.

- 객체의 모양을 빚는 것은 객체가 참여하는 협력이다.
  - 어떤 협력에 참여하는지가 객체에 필요한 행동을 결정한다.
    - 필요한 행동이 객체의 상태를 결정한다.
      - 개별적인 객체의 행동이나 상태가 아니라 객체들 간의 협력에 집중하라.

## 협력

### 요청하고 응당하며 협력하는 사람들

- **협력**은 한 사람이 다른 사람에게 도움을 **요청**할 때 시작된다. 
  - 요청을 받은 사람은 요청에 **응답**한다.
- 협력은 다수의 요청과 응답으로 구성되며 전체적으로 협력은 다수의 연쇄적인 요청과 응답의 흐름으로 구성된다.

### 누가 파이를 훔쳤지?
- 객체지향 세계는 동일한 목적을 달성하기 위해 협력하는 객체들의 공동체

### 재판 속의 협력

-
  - 누군가가 왕에게 재판을 **요청**함으로써 재판이 시작된다.
  - 왕이 하얀 토끼에게 증인을 부를 것을 **요청**한다.
  - 왕의 요청을 받은 토끼는 모자 장수에게 증인석으로 입장할 것을 **요청**한다.
  - 모자 장수는 증인석에 입장함으로써 토끼의 요청에 **응답**한다.
  - 모자 장수의 입장은 왕이 토끼에게 요청했던 증인 호출에 대한 **응답**이기도 하다.
  - 이제 왕은 모자 장수에게 증언할 것을 **요청**한다.
  - 모자 장수는 자신이 알고 있는 내용을 증언함으로써 왕의 요청에 **응답**한다.

- 결국 어떤 등장인문들이 특정한 요청을 받아들일 수 있는 이유는 그 요청에 대해 적절한 방식으로 응답하는 데 필요한 지식과
행동 방식을 가지고 있기 때문이다. 그리고 요청과 응답은 협력에 참여하는 객체가 수행할 책임을 정의한다.

## 책임
객체지향의 세계에서는 어떤 객체가 어떤 요청에 대해 대답해줄 수 있거나, 적절한 행동을 할 의무가 있는 경우
해당 개체가 **책임**을 가진다고 말한다. 
- 어떤 대상에 대한 요청은 그 대상이 요청을 처리할 책임이 있음을 암시한다.

### 책임의 분류
책임은 객체에 의해 정의되는 응집도 있는 행위의 집합으로, 객체가 알아야 하는 정보와 객체가 수행할 수 있는 행위에 대해 개략적으로
서술한 문장이다.

- 하는 것(doing)
  - 객체를 생성하거나 계산을 하는 등의 스스로 하는 것
  - 다른 객체의 행동을 시작시키는 것
  - 다른 객체의 활동을 제어하고 조절하는 것
- 아는 것(knowing)
  - 개인적인 정보에 관해 아는 것
  - 관련된 객체에 관해 아는 것
  - 자신이 유도하거나 계산할 수 있는 것에 관해 아는 것

명확한 책임이 애플리케이션의 미래를 결정짓는다.

객체의 책임을 이야기할 때는 일반적으로 외부에서 접근 가능한 공용 서비스의 관점에서 이야기한다.
- 책임은 객체의 외부에 제공해줄 수 있는 정보(아는 것의 측면)와 외부에 제공해 줄 수 있는 서비스(하는 것의 측면)의 목록이다.
  - 따라서 책임은 객체의 **공용 인터페이스(public interface)** 를 구성한다. 공용 인터페이스의 개념은 뒤에서 다룰
객체지향의 중요한 원리 중 하나인 캡슐화로 이어진다.

### 책임과 메시지
협력 안에서 객체는 다른 객체로부터 요청이 전송됐을 경우에만 자신에게 주어진 책임을 수행한다.

- 메시지 전송(message-send): 객체가 다른 객체에게 주어진 책임을 수행하도록 요청을 보내는 것
- 두 객체간의 협력은 메시지를 통해 이뤄진다.
- 송신자: 메시지를 전송함으로써 협력을 요청하는 객체를
- 수신자: 메시지를 받아 요청을 처리하는 객체
- 메시지는 햡략을 위해 한 객체가 다른 객체로 접근할 수 있는 유일한 방법이다.

> 객체지향 설계는 협력에 참여하기 위해 어떤 객체가 어떤 책임을 수행해야 하고 어떤 객체로부터 메시지를 수신할 것인지를
> 결정하는 것으로부터 시작된다. 어떤 클래스가 필요하고 어떤 메서드를 포함해야 하는지를 결정하는 것은 책임과 메시지에 대한
> 대략적인 윤곽을 잡은 후에 시작해도 늦지 않다.

## 역할

### 책임의 집합이 의미하는 것
어떤 객체가 수행하는 책임의 집합은 객체가 협력 안에서 수행하는 역할을 암시한다.
- 역할은 재사용 가능하고 유연한 객체지향 설계를 낳는 매우 중요한 구성요소

### 역할이 답이다
- 역할은 협력 내에서 다른 객체로 대체할 수 있음을 나타내는 일종의 표식
- 역할을 대체하기 위해서는 각 역할이 수신할 수 있는 메시지를 동일한 방식으로 이해해야 한다.
- 동일한 역할을 수행할 수 있다는 것은 해당 객체들이 협력 내에서 동일한 책임의 집합을 수행할 수 있다는 것을 의미
- **동일한 역할을 수행하는 객체들이 동일한 메시지를 수신할 수 있기 때문에 동일한 책임을 수행할 수 있다**
- 역할은 객체지향 설계의 **단순성(simplicity), 유연성(flexibility), 재사용성(reusability)**을 뒷받침하는 핵심 개념이다.

### 협력의 추상화
- 역햘의 가장 큰 가치는 하나의 협력 안에 여러 종류의 객체가 참여할 수 있게 함으로써 협력을 추상화할 수 있다는 것이다.

### 대체 가능성
- 역할은 협력 안에서 구체적인 객체로 대체될 수 있는 추상적인 협력자
- 따라서 본질적으로 역할은 다른 객체에 의해 대체 가능함을 의미
- 객체가 역할을 대체 가능하기 위해서는 협력 안에서 역할이 수행하는 모든 책임을 동일하게 수행할 수 있어야 한다.
- 객체는 역할이 암시하는 책임보다 더 많은 책임을 가질 수 있다. 따라서 대부분의 경우에 객체의 타입과
역할 사이에는 **일반화/특수화 관계**가 성립하는 것이 일반적이다.
- 역할의 대체 가능성 -> 행위 호환성 -> 동일한 책임

## 객체의 모양을 결정하는 협력

### 흔한 오류
객체를 섬으로 바라보던 잘못된 눈길을 거두고 올바른 곳을 바라보라

### 협력을 따라 흐르는 객체의 책임
- 객체의 행위에 초점을 맞추기 위해서는 협력이라는 실행 문맥 안에서 책임을 분배해야 한다.
  - 각 객체가 가져야 하는 상태의 행위에 대해 고민하기 전에 그 객체가 참여할 문맥인 협력을 정의하라.
    - 가장 중요한 것은 충분히 자율적인 동시에 충분히 협력적인 객체를 창조하는 것
      - 객체를 충분히 협력적으로 만든 후에 협력이라는 문맥 안에서 객체를 충분히 자율적으로 만드는 것

## 객체지향 설계 기법
역할, 책임, 협력의 관점에서 애플리케이션을 설계하는 유용한 세 가지 기법

1. 책임-주도 설계(Responsibility-Driven Design)
   - 협력에 필요한 책임들을 식별하고 적합한 객체에게 책임을 할당하는 방식
2. 디자인 패턴(Design Pattern)
   - 전문가들이 반복적으로 사용하는 해결 방법을 정의해 놓은 설계 템플릿의 모음
   - 패턴은 전문가들이 특정 문제를 해결하기 위해 이미 식별해 놓은 역할, 책임, 협력의 모음
3. 테스트-주도 개발(Test-Driven Development)
   - 테스트를 먼저 작성하고 테스트를 통과하는 구체적인 코드를 추가하면서 애플리케이션을 완성해가는 방식
   - 실제 목적은 구체적인 코드를 작성해나가면서 역할, 책임, 협력을 식별하고 식별된 역할, 책임, 협력이 적합한지 피드백받는 것

### 책임-주도 설계
객체지향 설계의 핵심은 올바른 책임을 올바른 객체에 할당하는 것

- 책임-주도 설계는 객체의 책임을 중심으로 시스템을 구축하는 설계 방법으로 현재 가장 널리 받아들여지는 객체지향 설계 방법이다.



- 시스템이 사용자에게 제공해야 하는 기능인 시스템 책임을 파악한다.
- 시스템 책임을 더 작은 책임으로 분할한다.
- 분할된 책임을 수행할 수 있는 적절한 객체 또는 역할을 찾아 책임을 할당한다.
- 객체가 책임을 수행하는 중에 다른 객체의 도움이 필요한 경우 이를 책임질 적절한 객체 또는 역할을 찾는다.
- 해당 객체 또는 역할에게 책임을 할당함으로써 두 객체가 협력하게 한다.

### 디자인 패턴
- 디자인 패턴은 책임-주도 설계의 결과를 표현
- 디자인 패턴은 책임-주도 설계의 결과물인 동시에 지름길이다.

### 테스트-주도 개발
- 테스트를 통과하는 가장 간단한 코드를 작성한 후 리팩터링을 통해 중복을 제거하는 것
- 테스트-주도 개발을 통해 '작동하는 깔끔한 코드'를 얻을 수 있다.
- 테스트-주도 개발은 테스트를 작서하는 것이 아니라 책임을 수행할 객체 또는 클라이언트가 기대하는 객체의 역할이 메시지를 수신할 때
어떤 결과를 반환하고 그 과정에서 어떤 객체와 협력할 것인지에 대한 기대를 코드의 형태로 작성하는 것

## 4장 독후감
---
역할, 책임, 협력에 대해 알아보았고 역할, 책임, 협력의 관점에서 애플리케이션을 설계하는 기법 3가지도 알아보았다.
테스트-주도 개발을 하기 위해서는 객체지향에 대해 자세히 알아야하고 책임-주도 개발또한 할줄 알고 있어야 한다는 점에서 참 까다롭다고 느껴졌다.